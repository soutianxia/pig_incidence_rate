# 1、猪发病率预测模型训练数据说明文档

## 数据基本信息

- **数据文件**：pig_disease_training_data.csv
- **数据记录数**：161条
- **数据类型**：模拟训练数据（基于真实猪场环境参数和文献研究）
- **用途**：用于神经网络模型训练，预测猪群发病率

## 数据结构概览

### 数据字段总数：23个

- **特征变量**：22个
- **目标变量**：1个（incidence_rate）

## 变量详细说明

### 1. 环境因素（5个变量）

| 变量名           | 中文名称     | 数据类型 | 取值范围      | 说明               | 数据来源                                                     |
| ---------------- | ------------ | -------- | ------------- | ------------------ | ------------------------------------------------------------ |
| temperature      | 平均温度     | 数值型   | 7.5-40.5°C    | 猪舍内平均温度     | <mcreference link="https://m.renrendoc.com/paper/493383793.html" index="3">3</mcreference> |
| humidity         | 相对湿度     | 数值型   | 34.6-100%     | 猪舍内相对湿度     | <mcreference link="https://m.jinchutou.com/shtml/view-280431198.html" index="5">5</mcreference> |
| ventilation_rate | 通风率       | 数值型   | 100-2000 m³/h | 猪舍通风量         | <mcreference link="https://m.book118.com/html/2025/1124/7042060060011014.shtm" index="2">2</mcreference> |
| ammonia_level    | 氨气浓度     | 数值型   | 1.4-25.5 ppm  | 猪舍内氨气浓度     | <mcreference link="https://m.book118.com/html/2025/1124/7042060060011014.shtm" index="2">2</mcreference> |
| co2_level        | 二氧化碳浓度 | 数值型   | 710-3000 ppm  | 猪舍内二氧化碳浓度 | <mcreference link="https://m.book118.com/html/2025/1124/7042060060011014.shtm" index="2">2</mcreference> |

### 2. 饲养管理因素（5个变量）

| 变量名            | 中文名称     | 数据类型 | 取值范围         | 说明                             | 数据来源                                                     |
| ----------------- | ------------ | -------- | ---------------- | -------------------------------- | ------------------------------------------------------------ |
| pig_density       | 猪群密度     | 数值型   | 0.2-5.5 头/m²    | 每平方米猪只数量                 | <mcreference link="https://m.renrendoc.com/paper/493383793.html" index="3">3</mcreference> |
| avg_feed_intake   | 平均采食量   | 数值型   | 1.0-4.1 kg/天/头 | 每头猪日均采食量                 | <mcreference link="https://www.renrendoc.com/paper/493588278.html" index="4">4</mcreference> |
| water_quality     | 水质评分     | 数值型   | 1-5分            | 1分最差，5分最优。详细评分标准： | 5分：水质优良，符合饮用水标准，无色无味，微生物含量极低 4分：水质良好，无明显异味，微生物含量在安全范围内 3分：水质一般，略有异味，微生物含量接近警戒值 2分：水质较差，有明显异味，微生物含量超标 1分：水质极差，浑浊有明显污染物，严重影响猪只健康 \| <mcreference link="https://www.renrendoc.com/paper/493588278.html" index="4">4</mcreference> |
| feed_quality      | 饲料质量评分 | 数值型   | 1-5分            | 1分最差，5分最优。详细评分标准： | <mcreference link="https://www.renrendoc.com/paper/493588278.html" index="4">4</mcreference> |
| bedding_condition | 垫料条件评分 | 数值型   | 1-5分            | 1分最差，5分最优。详细评分标准： | <mcreference link="https://www.renrendoc.com/paper/493588278.html" index="4">4</mcreference> |



### 3. 生物安全因素（5个变量）

| 变量名                    | 中文名称         | 数据类型 | 取值范围 | 说明                                 | 数据来源                                                     |
| ------------------------- | ---------------- | -------- | -------- | ------------------------------------ | ------------------------------------------------------------ |
| vaccination_rate          | 疫苗接种率       | 数值型   | 50-100%  | 猪群疫苗接种比例                     | <mcreference link="https://m.renrendoc.com/paper/493260087.html" index="2">2</mcreference> |
| disinfection_frequency    | 消毒频率         | 数值型   | 1-9次/周 | 每周消毒次数                         | <mcreference link="https://m.renrendoc.com/paper/493260087.html" index="2">2</mcreference> |
| quarantine_days           | 隔离天数         | 数值型   | 1-10天   | 新引进猪只隔离时间                   | <mcreference link="https://m.renrendoc.com/paper/493260087.html" index="2">2</mcreference> |
| staff_biosecurity_score   | 人员生物安全评分 | 数值型   | 3-9分    | 人员生物安全操作评分。详细评分标准： | 9分：完全符合生物安全要求，严格执行消毒、更衣、洗澡等措施 8分：很好执行生物安全措施，偶有小疏漏 7分：较好执行生物安全措施，基本符合要求 6分：一般执行生物安全措施，存在部分不规范行为 5分：执行生物安全措施较差，常有不规范行为 4分：很少执行生物安全措施，存在明显风险行为 3分：几乎不执行生物安全措施，严重违反规定 <mcreference link="https://www.renrendoc.com/paper/493588278.html" index="4">4</mcreference> |
| visitor_restriction_level | 访客限制级别     | 数值型   | 1-5级    | 1级最松，5级最严。详细评分标准：     | 5级：禁止所有非必要访客，必要访客需经过严格消毒(≥30分钟)、更换专用服装、隔离观察 4级：严格限制访客数量，访客需消毒(≥20分钟)、更换专用服装 3级：限制访客数量，访客需基本消毒(≥10分钟)、穿戴防护装备 2级：一般限制访客，访客需简单消毒、登记信息 1级：几乎不限制访客，仅基本登记<mcreference link="https://www.renrendoc.com/paper/493588278.html" index="4">4</mcreference> |



### 4. 猪群特征（5个变量）

| 变量名              | 中文名称     | 数据类型 | 取值范围  | 说明                                   | 数据来源                                                     |
| ------------------- | ------------ | -------- | --------- | -------------------------------------- | ------------------------------------------------------------ |
| avg_age             | 平均日龄     | 数值型   | 20-305天  | 猪群平均日龄                           | <mcreference link="https://bbs.zhue.com.cn/forum.php?mod=viewthread&tid=3349446&page=1&authorid=13374053" index="5">5</mcreference> |
| breed_type          | 品种类型     | 数值型   | 1-4       | 1=长白猪, 2=大白猪, 3=杜洛克, 4=杂交猪 | <mcreference link="https://m.renrendoc.com/paper/493260087.html" index="2">2</mcreference> |
| health_score        | 基础健康评分 | 数值型   | 5-9分     | 猪群基础健康状况评分。详细评分标准：   | 9分：猪群健康状况极佳，精神饱满，食欲旺盛，生长良好，无任何异常症状 8分：猪群健康状况良好，精神状态佳，食欲正常，偶有轻微异常 7分：猪群健康状况一般，精神状态尚可，食欲基本正常，有少量轻微症状 6分：猪群健康状况较差，精神状态不佳，食欲下降，部分猪只出现明显症状 5分：猪群健康状况差，精神萎靡，食欲明显下降，多数猪只出现症状<mcreference link="https://m.renrendoc.com/paper/493260087.html" index="2">2</mcreference> |
| previous_incidence  | 前期发病率   | 数值型   | 0.2-25.3% | 前一阶段猪群发病率                     | <mcreference link="https://m.chemdrug.com/index.php?catid=7&itemid=3646109&moduleid=26" index="1">1</mcreference> |
| mortality_rate_prev | 前期死亡率   | 数值型   | 0.2-9.2%  | 前一阶段猪群死亡率                     | <mcreference link="https://m.renrendoc.com/paper/493588278.html" index="4">4</mcreference> |



### 5. 季节性因素（2个变量）

| 变量名          | 中文名称 | 数据类型 | 取值范围 | 说明                           | 数据来源                                                     |
| --------------- | -------- | -------- | -------- | ------------------------------ | ------------------------------------------------------------ |
| season          | 季节     | 数值型   | 1-4      | 1=春季, 2=夏季, 3=秋季, 4=冬季 | <mcreference link="https://m.jinchutou.com/shtml/view-280431198.html" index="5">5</mcreference> |
| is_rainy_season | 是否雨季 | 数值型   | 0-1      | 0=否, 1=是                     | <mcreference link="https://m.jinchutou.com/shtml/view-280431198.html" index="5">5</mcreference> |

### 6. 目标变量（1个）

| 变量名         | 中文名称 | 数据类型 | 取值范围  | 说明                                  | 数据来源                                                     |
| -------------- | -------- | -------- | --------- | ------------------------------------- | ------------------------------------------------------------ |
| incidence_rate | 发病率   | 数值型   | 0.3-26.0% | 猪群发病率 = 发病猪数/猪群总数 × 100% | <mcreference link="https://m.chemdrug.com/index.php?catid=7&itemid=3646109&moduleid=26" index="1">1</mcreference> |

### 7. 风险等级与数据特征关系

根据数据集分析，各风险等级对应的主要特征表现如下：

- **低风险**（发病率 < 2.0%）：饲养管理因素评分普遍较高（water_quality, feed_quality, bedding_condition 通常为4-5分），生物安全措施完善，环境条件良好
- **中风险**（发病率 2.0%-5.0%）：部分饲养管理因素评分中等（water_quality, feed_quality, bedding_condition 通常为3-4分），存在一定环境或管理隐患
- **高风险**（发病率 5.0%-10.0%）：饲养管理因素评分较低（water_quality, feed_quality, bedding_condition 通常为3分左右），环境条件偏差，生物安全措施执行不到位
- **极高风险**（发病率 > 10.0%）：饲养管理因素评分极差（water_quality, feed_quality, bedding_condition 通常为1-2分），环境恶化，生物安全体系存在严重漏洞 |

## 数据生成方法

本数据集是基于以下方法生成的模拟数据：

1. **参考真实参数范围**：根据文献研究确定各变量的合理取值范围
2. **相关性设计**：
   - 环境因素（温度、湿度、氨气浓度）与发病率呈正相关
   - 饲养密度与发病率呈正相关
   - 生物安全因素（疫苗接种率、消毒频率）与发病率呈负相关
   - 猪群健康评分与发病率呈负相关
3. **随机波动**：在基础相关性上添加随机波动，模拟真实数据的变异性
4. **异常值控制**：确保数据中包含一定比例的极端情况，以增强模型的鲁棒性

## 数据来源详细参考文献

1. 基于ARIMA的猪瘟发病率预测模型研究 <mcreference link="https://m.chemdrug.com/index.php?catid=7&itemid=3646109&moduleid=26" index="1">1</mcreference>
   - 提供了发病率计算方法和时间序列数据分析思路

2. 猪场主要疫病免疫效果评估模型的建立 <mcreference link="https://m.renrendoc.com/paper/493260087.html" index="2">2</mcreference>
   - 提供了生物安全指标和免疫效果评估方法

3. 猪传染性胸膜肺炎流行状况与防控 <mcreference link="https://m.renrendoc.com/paper/493383793.html" index="3">3</mcreference>
   - 详细说明了环境因素和饲养密度对疫病发生的影响

4. 动物饲养中的健康风险评估与预警 <mcreference link="https://www.renrendoc.com/paper/493588278.html" index="4">4</mcreference>
   - 提供了饲养管理和风险评估的关键指标

5. BP神经网络模型用于气象因素对PRRS发病预测的研究 <mcreference link="https://m.jinchutou.com/shtml/view-280431198.html" index="5">5</mcreference>
   - 提供了气象因素与猪病发病率关系的研究方法

6. 规模化猪场保育猪健康管理规范（NY/T 5033-2021）<mcreference link="https://bbs.zhue.com.cn/forum.php?mod=viewthread&tid=3349446&page=1&authorid=13374053" index="5">5</mcreference>
   - 提供了猪群健康管理的标准参数



# 2、train_model.py 算法说明文档

## 1. 算法概览

`train_model.py`是一个用于猪发病率预测的神经网络模型训练脚本，基于PyTorch深度学习框架实现。该脚本构建了一个多层感知机（MLP）回归模型，通过学习环境因素、饲养管理、生物安全措施等特征与猪群发病率之间的关系，实现对猪群发病率的精准预测。

### 主要功能与设计思路

- **预测目标**：预测猪群的发病率（连续数值预测）
- **模型类型**：多层感知机回归模型
- **设计思路**：
  - 采用深度学习方法捕捉复杂的非线性关系
  - 通过标准化和正则化提高模型泛化能力
  - 使用批处理和学习率调度优化训练效率
  - 全面评估模型性能并可视化训练过程

## 2. 整体架构与功能模块

脚本采用模块化设计，包含四个核心功能模块和一个主函数，各模块职责明确、相互协作，形成完整的模型训练流程。

### 模块结构概览

```
train_model.py
├── load_and_preprocess_data(): 数据加载和预处理
├── NeuralNetwork类: 神经网络模型定义
├── train_model(): 模型训练与评估
├── save_model_and_scaler(): 模型和预处理对象保存
└── main(): 主函数，协调整体流程
```

### 各模块功能说明

1. **数据加载与预处理模块**：负责从CSV文件读取数据，进行标准化处理，划分训练集和测试集，并转换为PyTorch张量格式。

2. **模型定义模块**：通过`NeuralNetwork`类定义多层感知机模型的结构，包括输入层、隐藏层和输出层的配置。

3. **训练与评估模块**：实现模型训练过程，包括损失函数计算、参数优化、学习率调整、性能评估和训练过程可视化。

4. **模型保存模块**：将训练好的模型参数和数据标准化对象保存到指定目录，便于后续使用。

5. **主函数模块**：按顺序调用各功能模块，协调整个训练流程的执行。

## 3. 数据预处理流程

数据预处理是模型训练的重要环节，本脚本实现了完整的数据预处理流程，确保输入数据质量和格式符合模型要求。

### 预处理步骤详解

1. **数据加载**
   - 使用pandas从CSV文件读取训练数据
   - 数据格式：CSV文件，包含22个特征列和1个目标变量列（发病率）

2. **特征与目标变量分离**
   - 特征数据(X)：提取前22列作为模型输入特征
   - 目标变量(y)：提取最后一列作为预测目标（发病率）

3. **数据标准化**
   - 采用`StandardScaler`将特征数据标准化为均值为0、标准差为1的分布
   - 标准化可加速模型收敛并提高预测精度
   - 保存标量器对象，用于后续推理时的新数据预处理

4. **数据集划分**
   - 使用`train_test_split`将数据划分为训练集和测试集
   - 划分比例：训练集80%，测试集20%
   - 设置随机种子(42)确保结果可复现

5. **张量转换**
   - 将NumPy数组转换为PyTorch张量格式
   - 训练数据类型：`torch.FloatTensor`
   - 目标变量重塑为列向量格式，便于模型输出匹配

### 返回值说明

预处理函数返回一个字典，包含以下内容：

```python
return {
    'X_train': 训练特征张量,
    'X_test': 测试特征张量,
    'y_train': 训练目标张量,
    'y_test': 测试目标张量,
    'scaler': 训练好的数据标准化对象
}
```

## 4. 神经网络模型结构

模型采用多层感知机架构，通过多个全连接层和非线性激活函数构建，能够有效学习复杂的特征关系。

### 模型参数设置

- **输入层**：22个神经元，对应22个输入特征
- **隐藏层**：3层，神经元数量分别为64、32、16
- **输出层**：1个神经元，输出预测的发病率
- **激活函数**：ReLU (Rectified Linear Unit)
- **正则化**：Dropout层，丢弃率0.2

### 模型结构详解

```python
class NeuralNetwork(nn.Module):
    def __init__(self, input_size=22, hidden_sizes=[64, 32, 16], output_size=1):
        # 初始化网络架构
        # 构建层序列：线性层 -> ReLU激活 -> Dropout -> 线性层 -> ...
        
    def forward(self, x):
        # 前向传播计算
        return self.model(x)
```

### 结构设计特点

1. **层级递减设计**：隐藏层神经元数量依次减少(64→32→16)，有助于特征抽象和信息压缩

2. **非线性激活**：每个隐藏层后使用ReLU激活函数引入非线性变换，增强模型表示能力

3. **Dropout正则化**：每层后添加Dropout层随机失活20%的神经元，有效防止过拟合

4. **模块化构建**：使用`nn.Sequential`组合网络层，提高代码可读性和可维护性

5. **灵活性设计**：支持自定义输入特征数量、隐藏层结构和输出维度，便于扩展和修改

## 5. 模型训练过程与优化策略

训练过程采用现代深度学习优化技术，确保模型快速收敛并获得良好的泛化性能。

### 训练参数配置

- **训练轮次(epochs)**：500轮
- **批量大小(batch_size)**：32
- **初始学习率**：0.001
- **损失函数**：均方误差(MSE)
- **优化器**：Adam
- **学习率调度策略**：ReduceLROnPlateau

### 训练流程详解

1. **数据准备**
   - 创建数据加载器，支持批量处理和随机打乱
   - 批量大小设置为32，平衡内存使用和训练效率

2. **损失函数与优化器**
   - 使用均方误差(MSE)作为回归任务的损失函数
   - 选择Adam优化器，结合动量和自适应学习率，加速收敛

3. **学习率调度**
   - 采用`ReduceLROnPlateau`策略，监控验证损失
   - 当验证损失停止下降时，将学习率减半(factor=0.5)
   - 容忍验证损失停滞轮次(patience)设为10

4. **训练循环**
   - 迭代500轮训练
   - 每轮包含前向传播、损失计算、反向传播和参数更新
   - 使用梯度清零(`optimizer.zero_grad()`)避免梯度累积

5. **模型评估**
   - 每轮训练后在测试集上评估模型性能
   - 使用`model.eval()`和`torch.no_grad()`模式进行推理，节省内存

6. **训练可视化**
   - 记录并绘制训练和测试损失曲线
   - 每10轮打印一次损失信息，监控训练进度

### 过拟合防止策略

1. **Dropout正则化**：在每个隐藏层后添加Dropout层，随机失活部分神经元

2. **数据分割**：预留20%数据作为测试集，用于评估模型泛化能力

3. **学习率调度**：动态调整学习率，避免模型陷入局部最优

4. **早停机制**：通过学习率调度间接实现早停效果

## 6. 评估指标与模型保存

### 模型评估指标

训练完成后，模型在测试集上计算以下评估指标：

1. **均方根误差(RMSE)**：反映预测值与真实值之间的平均偏差
2. **决定系数(R²)**：衡量模型解释目标变量变异的能力，取值范围0-1，越接近1表示模型拟合效果越好

### 评估结果输出

```
模型评估结果:
均方根误差 (RMSE): 具体数值
决定系数 (R²): 具体数值
```

### 训练过程可视化

生成并保存训练和测试损失随迭代轮次变化的曲线图：

- 文件名：`training_loss.png`
- 图表内容：训练损失曲线和测试损失曲线
- 可视化指标：损失值、轮次、图例、网格线

### 模型保存机制

训练完成后，将模型参数和数据预处理对象保存到指定目录：

1. **保存内容**：
   - 模型参数：以PyTorch状态字典格式保存
   - 数据标准化对象：以pickle格式保存

2. **保存路径**：
   - 默认目录：`models/`
   - 模型文件：`models/pig_disease_model.pth`
   - 标量器文件：`models/scaler.pkl`

3. **目录管理**：
   - 自动创建不存在的目录，确保保存成功
   - 保存完成后输出确认信息

## 7. 输入输出示例

### 输入数据格式

训练数据为CSV格式文件，包含23列数据：

- 前22列为特征数据，包括环境因素、饲养管理、生物安全措施等
- 最后一列为目标变量：发病率（数值型）

### 输出结果

1. **训练过程输出**：

   ```
   Epoch [10/500], Train Loss: 0.023456, Test Loss: 0.024567
   Epoch [20/500], Train Loss: 0.019876, Test Loss: 0.020123
   ...
   ```

2. **模型评估输出**：

   ```
   模型评估结果:
   均方根误差 (RMSE): 0.015678
   决定系数 (R²): 0.876543
   ```

3. **保存确认输出**：

   ```
   模型和标量器已保存到 models 目录
   ```

## 8. 代码优化建议

1. **早停机制优化**：

   ```python
   # 添加早停机制以进一步防止过拟合
   patience = 20
   best_test_loss = float('inf')
   counter = 0
   
   for epoch in range(epochs):
       # 训练代码...
       
       # 早停检查
       if test_loss < best_test_loss:
           best_test_loss = test_loss
           counter = 0
           # 保存最佳模型
           torch.save(model.state_dict(), os.path.join(model_dir, 'best_model.pth'))
       else:
           counter += 1
           if counter >= patience:
               print(f'早停在轮次 {epoch+1}')
               break
   ```

2. **交叉验证**：

   ```python
   # 添加K折交叉验证提高评估可靠性
   from sklearn.model_selection import KFold
   
   kf = KFold(n_splits=5, shuffle=True, random_state=42)
   all_rmse = []
   
   for fold, (train_idx, val_idx) in enumerate(kf.split(X_scaled)):
       print(f'Fold {fold+1}/5')
       # 训练和验证代码...
   ```

3. **超参数调优**：

   ```python
   # 使用网格搜索或随机搜索调优超参数
   from sklearn.model_selection import GridSearchCV
   
   param_grid = {
       'hidden_sizes': [[64, 32, 16], [128, 64, 32], [64, 32]],
       'learning_rate': [0.001, 0.0001],
       'batch_size': [32, 64]
   }
   ```

4. **数据增强**：

   ```python
   # 添加数据增强以提高模型鲁棒性
   def augment_data(X, y, augmentation_factor=0.1):
       # 添加噪声等数据增强方法
       return augmented_X, augmented_y
   ```

## 9. 依赖项说明

- **核心库**：
  - pandas: 数据处理和分析
  - numpy: 数值计算
  - torch: 深度学习框架
  - scikit-learn: 数据预处理和模型评估
  - matplotlib: 可视化
  - joblib: 模型序列化

- **版本兼容性**：
  - 推荐使用Python 3.7+环境
  - PyTorch 1.7+版本
  - scikit-learn 0.23+版本

---

本文档详细说明了`train_model.py`的算法原理、实现细节和使用方法，为模型的使用、维护和扩展提供了全面指导。通过遵循文档中的说明，可以有效训练猪发病率预测模型，并根据实际需求进行调整和优化。



# 3、猪发病率预测系统

## 项目概述

本项目基于神经网络算法，构建了一个猪群发病率预测系统，能够根据多种环境、饲养管理、生物安全等因素预测猪群的发病率风险，并通过FastAPI封装为HTTP接口，方便集成到各类养殖管理系统中。

## 项目结构

```
├── pig_disease_training_data.csv   # 训练数据文件
├── train_model.py                  # 神经网络模型训练代码
├── api.py                          # FastAPI接口封装代码
├── models/                         # 保存的模型和标量器
│   ├── pig_disease_model.pth       # 训练好的PyTorch模型
│   └── scaler.pkl                  # 数据标准化标量器
├── training_loss.png               # 训练过程损失曲线
├── README.md                       # 项目说明文档
├── 变量设计说明.md                  # 特征变量设计说明
├── 数据说明文档.md                  # 训练数据详细说明
└── 验证CSV文件.py                   # 数据验证脚本
```

## 技术栈

- **开发语言**: Python 3.8+
- **机器学习框架**: PyTorch
- **Web框架**: FastAPI
- **数据处理**: Pandas, NumPy, Scikit-learn
- **API服务**: Uvicorn

## 安装与配置

### 1. 环境准备

```bash
# 创建并激活虚拟环境
python -m venv .venv
# Windows激活
.venv\Scripts\activate
# Linux/Mac激活
# source .venv/bin/activate

# 安装依赖包
pip install torch fastapi uvicorn scikit-learn matplotlib joblib pandas numpy
```

### 2. 数据准备

项目包含了模拟的训练数据文件 `pig_disease_training_data.csv`，包含200条记录，涵盖22个特征变量和1个目标变量（发病率）。

数据详细说明请参考 `数据说明文档.md`。

## 模型训练

### 1. 运行训练脚本

```bash
python train_model.py
```

### 2. 训练过程说明

- 脚本会自动加载CSV数据，进行标准化处理
- 划分训练集（80%）和测试集（20%）
- 训练一个3层全连接神经网络（64-32-16节点）
- 使用Adam优化器，学习率为0.001，训练500个epoch
- 保存训练好的模型和标量器到 `models` 目录
- 生成训练损失曲线 `training_loss.png`

### 3. 模型评估结果

训练完成后，会输出模型在测试集上的评估指标：

- 均方根误差 (RMSE)
- 决定系数 (R²)

## API使用方法

### 1. 启动API服务

```bash
# 方法1：直接运行api.py
python api.py

# 方法2：使用uvicorn启动（推荐）
uvicorn api:app --host 0.0.0.0 --port 8000 --reload
```

### 2. 访问API文档

API服务启动后，可以通过以下地址访问自动生成的API文档：

- **交互式API文档**: http://localhost:8000/docs
- **OpenAPI规范**: http://localhost:8000/openapi.json

## API接口文档

### 1. 健康检查接口

- **URL**: `/health`

- **方法**: `GET`

- **功能**: 检查API服务和模型是否正常运行

- **响应示例**:

  ```json
  {
    "status": "healthy",
    "model_loaded": true
  }
  ```

### 2. 单条预测接口

- **URL**: `/predict`

- **方法**: `POST`

- **功能**: 根据输入的特征数据预测猪群发病率

- **请求体**:

  ```json
  {
    "temperature": 25.5,            # 环境温度(°C)
    "humidity": 65.2,              # 相对湿度(%)
    "ventilation_rate": 1200,      # 通风率
    "ammonia_level": 15.0,         # 氨水平
    "co2_level": 3000,             # 二氧化碳水平
    "pig_density": 0.8,            # 猪群密度
    "avg_feed_intake": 2.5,        # 平均采食量
    "water_quality": 4,            # 水质评分（5分制）
    "feed_quality": 4,             # 饲料质量评分（5分制）
    "bedding_condition": 3,        # 垫料条件（5分制）
    "vaccination_rate": 95.0,      # 疫苗接种率(%)
    "disinfection_frequency": 4,   # 消毒频率
    "quarantine_days": 14,         # 检疫天数
    "staff_biosecurity_score": 8,  # 员工生物安全评分
    "visitor_restriction_level": 5,# 访客限制等级
    "avg_age": 90,                 # 平均年龄(日龄)
    "breed_type": 2,               # 品种类型
    "health_score": 7,             # 健康评分
    "previous_incidence": 20,      # 前一周发病率(%)
    "mortality_rate_prev": 8,      # 前一周死亡率(%)
    "season": 2,                   # 季节(1-4)
    "is_rainy_season": 0           # 是否雨季(0/1)
  }
  ```

- **响应示例**:

  ```json
  {
    "predicted_incidence": 1.9,       # 预测的发病率(%)
    "confidence": 0.85,              # 预测置信度
    "risk_level": "中等风险",        # 风险等级
    "recommendations": [             # 防控建议
      "加强环境消毒频率",
      "检查饲料和饮水质量",
      "降低养殖密度",
      "增加兽医巡查频次"
    ]
  }
  ```

### 3. 批量预测接口

- **URL**: `/batch_predict`

- **方法**: `POST`

- **功能**: 批量预测多条数据的猪群发病率

- **请求体**:

  ```json
  {
    "data": [
      {
        "temperature": 25.5,
        "humidity": 65.2,
        "ventilation_rate": 1200,
        "ammonia_level": 15.0,
        "co2_level": 3000,
        "pig_density": 0.8,
        "avg_feed_intake": 2.5,
        "water_quality": 4,
        "feed_quality": 4,
        "bedding_condition": 3,
        "vaccination_rate": 95.0,
        "disinfection_frequency": 4,
        "quarantine_days": 14,
        "staff_biosecurity_score": 8,
        "visitor_restriction_level": 5,
        "avg_age": 90,
        "breed_type": 2,
        "health_score": 7,
        "previous_incidence": 20,
        "mortality_rate_prev": 8,
        "season": 2,
        "is_rainy_season": 0
      },
      {
        "temperature": 26.0,
        "humidity": 70.0,
        "ventilation_rate": 1100,
        "ammonia_level": 20.0,
        "co2_level": 3500,
        "pig_density": 0.9,
        "avg_feed_intake": 2.3,
        "water_quality": 3,
        "feed_quality": 3,
        "bedding_condition": 3,
        "vaccination_rate": 92.0,
        "disinfection_frequency": 3,
        "quarantine_days": 10,
        "staff_biosecurity_score": 7,
        "visitor_restriction_level": 4,
        "avg_age": 85,
        "breed_type": 3,
        "health_score": 6,
        "previous_incidence": 25,
        "mortality_rate_prev": 10,
        "season": 3,
        "is_rainy_season": 1
      }
    ]
  }
  ```

- **响应示例**:

  ```json
  {
    "predictions": [
      {
        "predicted_incidence": 1.9,
        "confidence": 0.85,
        "risk_level": "中等风险",
        "recommendations": ["建议1", "建议2", ...]
      },
      {
        "predicted_incidence": 3.2,
        "confidence": 0.80,
        "risk_level": "高风险",
        "recommendations": ["建议1", "建议2", ...]
      }
    ]
  }
  ```

### 4. 模型信息接口

- **URL**: `/model/info`

- **方法**: `GET`

- **功能**: 获取模型的基本信息

- **响应示例**:

  ```json
  {
    "model_type": "神经网络",
    "input_features": 22,
    "hidden_layers": [64, 32, 16],
    "output": "猪群发病率预测",
    "framework": "PyTorch",
    "version": "1.0"
  }
  ```

## 示例请求

### PowerShell示例

```powershell
# 健康检查
Invoke-WebRequest -Uri "http://localhost:8000/health" -Method Get | Select-Object -Expand Content

# 单条预测
Invoke-WebRequest -Uri "http://localhost:8000/predict" -Method Post -ContentType "application/json" -Body '{"temperature": 25.5, "humidity": 65.2, "ventilation_rate": 1200, "ammonia_level": 15.0, "co2_level": 3000, "pig_density": 0.8, "avg_feed_intake": 2.5, "water_quality": 4, "feed_quality": 4, "bedding_condition": 3, "vaccination_rate": 95.0, "disinfection_frequency": 4, "quarantine_days": 14, "staff_biosecurity_score": 8, "visitor_restriction_level": 5, "avg_age": 90, "breed_type": 2, "health_score": 7, "previous_incidence": 20, "mortality_rate_prev": 8, "season": 2, "is_rainy_season": 0}' | Select-Object -Expand Content
```

### Python示例

```python
import requests
import json

# 单条预测
url = "http://localhost:8000/predict"
headers = {"Content-Type": "application/json"}

data = {
    "temperature": 25.5,
    "humidity": 65.2,
    "ventilation_rate": 1200,
    "ammonia_level": 15.0,
    "co2_level": 3000,
    "pig_density": 0.8,
    "avg_feed_intake": 2.5,
    "water_quality": 4,
    "feed_quality": 4,
    "bedding_condition": 3,
    "vaccination_rate": 95.0,
    "disinfection_frequency": 4,
    "quarantine_days": 14,
    "staff_biosecurity_score": 8,
    "visitor_restriction_level": 5,
    "avg_age": 90,
    "breed_type": 2,
    "health_score": 7,
    "previous_incidence": 20,
    "mortality_rate_prev": 8,
    "season": 2,
    "is_rainy_season": 0
}

response = requests.post(url, headers=headers, data=json.dumps(data))
print(response.json())
```

## 风险等级说明

| 风险等级 | 发病率范围  | 置信度 | 应对策略         |
| -------- | ----------- | ------ | ---------------- |
| 低风险   | < 1.0%      | 0.95   | 维持当前管理水平 |
| 中等风险 | 1.0% - 3.0% | 0.85   | 加强监测和预防   |
| 高风险   | 3.0% - 5.0% | 0.80   | 采取紧急防控措施 |
| 极高风险 | > 5.0%      | 0.75   | 启动应急预案     |

## 注意事项

1. **数据质量**：请确保输入数据在合理范围内，API会进行参数验证
2. **模型更新**：随着新数据的积累，建议定期重新训练模型以提高预测准确性
3. **API部署**：生产环境部署时，建议使用Gunicorn+Uvicorn的组合以提高性能
4. **并发处理**：API支持批量预测功能，可以减少多次请求的开销
5. **监控告警**：建议设置系统监控，当预测风险等级为高风险或极高风险时触发告警

## 扩展与优化建议

1. **模型优化**：可以尝试其他深度学习架构（如LSTM、CNN）或集成学习方法
2. **实时数据**：接入物联网设备，获取实时环境和猪群数据
3. **多模型融合**：结合传统统计模型和深度学习模型，提高预测稳定性
4. **特征工程**：进一步挖掘和构建更有价值的特征变量
5. **可解释性增强**：添加模型解释功能，分析各因素对发病率的影响权重

## 许可证

本项目仅供学术研究和技术演示使用。

